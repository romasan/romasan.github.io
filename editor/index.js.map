{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;;AAEA,OAAO,MAAP,GAAgB,YAAI;;AAEnB,UAAS,IAAT,CAAc,gBAAd,CAA+B,WAA/B,EAA4C,SAA5C;;;AAGA;;AAEA;;AAEA,GAAE,UAAF,EAAc,KAAd,CAAoB,IAApB;AACA,GAAE,UAAF,EAAc,KAAd,CAAoB,WAApB;AACA,GAAE,UAAF,EAAc,KAAd,CAAoB,OAApB;;AAEA,GAAE,UAAF,EAAc,EAAd,CAAiB,OAAjB,EAA0B,YAAW;AACpC,OAAK,MAAL;AACA,EAFD;AAGA,CAhBD;;;IAmBM,U;AACL,uBAAc;AAAA;;AACb,OAAK,OAAL,GAAe,EAAf;AACA;;;;qBACE,K,EAAO,S,EAAW;AACpB,OAAG,KAAK,OAAL,CAAa,KAAb,CAAH,EAAwB;AACvB,SAAK,OAAL,CAAa,KAAb,EAAoB,IAApB,CAAyB,SAAzB;AACA,IAFD,MAEO;AACN,SAAK,OAAL,CAAa,KAAb,IAAsB,CAAC,SAAD,CAAtB;AACA;AACD;;;sBACE,K,EAAO,K,EAAO;AAChB,OAAG,KAAK,OAAL,CAAa,KAAb,CAAH,EAAwB;AACvB,SAAI,IAAI,CAAR,IAAa,KAAK,OAAL,CAAa,KAAb,CAAb,EAAkC;AACjC,SAAG,OAAO,KAAK,OAAL,CAAa,KAAb,EAAoB,CAApB,CAAP,IAAiC,UAApC,EAAgD;AAC/C,WAAK,OAAL,CAAa,KAAb,EAAoB,CAApB,EAAuB,KAAvB;AACA;AACD;AACD;AACD;;;;;;AACD;;AAED,IAAI,QAAQ,IAAI,UAAJ,EAAZ;;AAEA,IAAI,aAAa;AACf,OAAY,QADG;AAEf,MAAY,KAFG;AAGf,MAAY,KAHG;AAIf,UAAY,KAJG;AAKf,WAAY,KALG;AAMf,YAAY;AANG,CAAjB;;AASA,IAAI,gBAAgB;AAClB,OAAW,WADO;AAElB,MAAW,CAFO;AAGlB,MAAW,CAHO;AAIlB,UAAW,GAJO;AAKlB,WAAW;AALO,CAApB;;AAQA,IAAI,OAAO,IAAX;AACA,IAAI,SAAS,EAAb;;AAEA,IAAI,YAAY,SAAZ,SAAY,CAAC,CAAD,EAAK;;AAEpB,KAAG,EAAE,MAAF,CAAS,SAAT,CAAmB,OAAnB,CAA2B,cAA3B,KAA8C,CAAjD,EAAoD;;AAEnD,MAAI,WAAW;AACd,OAAS,EAAE,MAAF,CAAS,EADJ;AAEd,UAAS,EAAE,MAAF,CAAS,KAFJ;AAGd,WAAS,EAAE,MAAF,CAAS,MAHJ;AAId,MAAS,EAAE,MAAF,CAAS,UAAT,CAAoB,UAJf;AAKd,MAAS,EAAE,MAAF,CAAS,UAAT,CAAoB;AALf,GAAf;;;;AAUA,cAAY,QAAZ;AACA;AACD,CAhBD;;AAkBA,IAAI,OAAO,SAAP,IAAO,GAAI;;AAEd,KAAI,MAAM,EAAE,WAAF,EAAe,GAAf,EAAV;AACA,KAAG,OAAO,EAAV,EAAc;AACb,QAAM,aAAN;AACA,EAFD,MAEO,IAAG,KAAK,MAAL,CAAY,GAAZ,CAAH,EAAqB;AAC3B,QAAM,MAAM,GAAN,GAAY,SAAlB;AACA,EAFM,MAEA;AACN,MAAI,SAAS,EAAb;AACA,OAAI,IAAI,CAAR,IAAa,UAAb,EAAyB;AACxB,OAAG,KAAK,IAAL,IAAa,WAAW,CAAX,KAAiB,KAAjC,EAAwC;AACvC,WAAO,CAAP,IAAY,EAAE,YAAY,CAAd,EAAiB,GAAjB,EAAZ;AACA,IAFD,MAEO,IAAG,WAAW,CAAX,KAAiB,OAApB,EAA6B;AACnC,WAAO,CAAP,IAAY,EAAZ;AACA;AACD;AACD,OAAK,MAAL,CAAY,GAAZ,IAAmB,MAAnB;AACA,WAAS,GAAT,EAAc,KAAK,MAAL,CAAY,GAAZ,CAAd;AACA;;AAED,CApBD;;AAsBA,IAAI,SAAS,SAAT,MAAS,GAAI;AAChB,MAAI,IAAI,CAAR,IAAa,UAAb,EAAyB;AACxB,IAAE,YAAY,CAAd,EAAiB,IAAjB,CAAsB,EAAC,OAAO,IAAR,EAAtB;AACA;AACD,CAJD;;AAMA,IAAI,cAAc,SAAd,WAAc,GAAI;AACrB,MAAI,IAAI,CAAR,IAAa,aAAb,EAA4B;AAC3B,IAAE,YAAY,CAAd,EAAiB,IAAjB,CAAsB,EAAC,OAAO,cAAc,CAAd,CAAR,EAAtB;AACA;AACD,CAJD;;AAMA,IAAI,cAAc,SAAd,WAAc,GAAM;;AAEvB;;AAEA,CAJD;;AAMA,IAAI,UAAU,SAAV,OAAU,CAAC,GAAD,EAAM,MAAN,EAAe;AAC5B,KAAG,CAAC,KAAK,MAAL,CAAY,GAAZ,CAAJ,EAAsB;AAAE;AAAS;AACjC,MAAI,IAAI,CAAR,IAAa,MAAb,EAAqB;AACpB,MAAG,KAAK,IAAR,EAAc;AACb,QAAK,MAAL,CAAY,GAAZ,EAAiB,CAAjB,IAAsB,OAAO,CAAP,CAAtB;AACA;AACD;AACD,CAPD;;AASA,IAAI,iBAAiB,SAAjB,cAAiB,GAAI;AACxB,KAAI,QAAQ,UAAZ;;AAEA,SAAQ,GAAR,CAAY,iBAAZ,EAA+B,KAA/B;;AAEA,SAAQ,MAAM,EAAd,EAAkB,KAAlB;AACA,CAND;;AAQA,IAAI,WAAW,SAAX,QAAW,GAAI;AAClB,KAAI,QAAQ,EAAZ;AACA,MAAI,IAAI,CAAR,IAAa,UAAb,EAAyB;AACxB,QAAM,CAAN,IAAW,EAAE,YAAY,CAAd,EAAiB,GAAjB,EAAX;AACA;AACD,QAAO,KAAP;AACA,CAND;;;AASA,IAAI,UAAU,SAAV,OAAU,GAAI;AACjB,QAAO,KAAK,SAAL,CAAe,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAAP;AACA,CAFD;;AAIA,IAAI,UAAU,SAAV,OAAU,GAAI;;AAEjB,KAAI,QAAQ,SAAZ;;;AAGA,GAAE,UAAF,EACE,GADF,CACM,KADN,EAEE,IAFF,GAGE,MAHF,GAIE,GAJF,CAIM,EAAC,QAAQ,GAAT,EAJN;AAKA,GAAE,WAAF,EACE,IADF;AAEA,CAZD;;AAcA,IAAM,UAAU,IAAhB;;AAEA,OAAO,OAAP,GAAiB,UAAC,CAAD,EAAO;AACvB,KAAG,EAAE,OAAF,IAAa,OAAhB,EAAyB;AACxB,IAAE,WAAF,EACE,IADF;AAEA,IAAE,UAAF,EACE,IADF;AAEA;AACD,CAPD;;;AAUA,IAAI,WAAW,SAAX,QAAW,CAAC,KAAD,EAAQ,MAAR,EAAiB;;AAE/B,GAAE,YAAF,EAAgB,MAAhB,CACE,EAAE,OAAF,EACE,IADF,CACO;AACL,OAAK,YAAY,KAAZ,GAAoB,MADpB;AAEL,MAAI;AAFC,EADP,CADF;AAOC,GAAE,MAAM,KAAR,EACE,GADF,CACM;AACJ,SAAS,OAAO,KAAP,GAAgB,IADrB;AAEJ,UAAS,OAAO,MAAP,GAAgB,IAFrB;AAGJ,OAAS,OAAO,CAAP,GAAgB,IAHrB;AAIJ,QAAS,OAAO,CAAP,GAAgB;AAJrB,EADN,EAOE,SAPF,CAOY;AACP,eAAa,OAAO,KAAP,GAAe,OAAO,MAD5B;AAEP,QAAM,cAAC,CAAD,EAAO;AACZ,WAAQ,GAAR,CAAY,SAAZ,EAAuB,CAAvB;AACA;AAJM,EAPZ;;AAAA,EAcE,MAdF,GAeG,SAfH,CAea;AACV,SAAO,OADG;AAEV,QAAK,CAAC,EAAD,EAAK,EAAL,CAFK;AAGV,QAAM,cAAC,CAAD,EAAO;AACZ,WAAQ,GAAR,CAAY,OAAZ,EAAqB,CAArB;AACA;AALS,EAfb;;AAAA,EAuBG,QAvBH,CAuBY,MAvBZ,EAwBG,GAxBH,CAwBO,EAAC,UAAU,UAAX,EAxBP;AAyBD,CAlCD;;AAoCA,IAAI,QAAQ,SAAR,KAAQ,GAAI;;;;AAIf,UAAS,EAAT;;AAEA,MAAI,IAAI,SAAR,IAAqB,KAAK,MAA1B,EAAkC;;AAEjC,WAAS,SAAT,EAAoB,KAAK,MAAL,CAAY,SAAZ,CAApB;AACA;AACD,CAVD;;AAYA,IAAI,aAAa,SAAb,UAAa,CAAC,IAAD,EAAQ;;AAExB,GAAE,WAAF,EAAe,MAAf,CACC,EAAE,OAAF,EAAW,MAAX,CACC,EAAE,SAAF,EACE,MADF,CAEE,EAAE,QAAF,EACE,IADF,CACO,OAAO,GADd,CAFF,EAKE,MALF,CAME,EAAE,SAAF,EACE,IADF,CACO;AACL,MAAI,WAAW,IADV;AAEL,SAAO;AAFF,EADP,EAKE,QALF,CAKW,gBALX,CANF,CADD,CADD;AAiBA,CAnBD;;AAqBA,IAAI,YAAY,SAAZ,SAAY,GAAI;;AAEnB,KAAI,IAAI,EAAR;AACA,MAAI,IAAI,IAAR,IAAgB,UAAhB,EAA4B;;AAE3B,MAAG,WAAW,IAAX,KAAoB,KAAvB,EAA8B;AAC7B,KAAE,IAAF,IAAU,CAAV;AACA;;AAED,MAAG,WAAW,IAAX,KAAoB,QAAvB,EAAiC;AAChC,KAAE,IAAF,IAAU,EAAV;AACA;;AAED,MAAG,WAAW,IAAX,KAAoB,OAAvB,EAAgC;AAC9B,KAAE,IAAF,IAAU,EAAV;AACD;;AAED,MACC,WAAW,IAAX,KAAoB,KAApB,IACA,WAAW,IAAX,KAAoB,QAFrB,EAGE;AACD,cAAW,IAAX;AACA;AACD;;AAED,GAAE,iBAAF,EAAqB,EAArB,CAAwB,QAAxB,EAAkC,WAAlC;;AAEA,GAAE,WAAF,EAAe,MAAf,CACC,EAAE,UAAF,EACE,IADF,CACO,EAAC,IAAI,SAAL,EADP,EAEE,IAFF,CAEO,KAFP,CADD;;AAMA,GAAE,WAAF,EAAe,MAAf,CACC,EAAE,UAAF,EACE,IADF,CACO,EAAC,IAAI,SAAL,EADP,EAEE,IAFF,CAEO,KAFP,CADD;;;;;;;;AAYA,GAAE,WAAF,EAAe,MAAf,CACC,EAAE,UAAF,EACE,IADF,CACO,EAAC,IAAI,SAAL,EADP,EAEE,IAFF,CAEO,UAFP,CADD;AAKA,CAlDD;;AAoDA,IAAI,cAAc,SAAd,WAAc,CAAC,QAAD,EAAY;;AAE7B,MAAI,IAAI,CAAR,IAAa,QAAb,EAAuB;AACtB,IAAE,YAAY,CAAd,EAAiB,IAAjB,CAAsB,EAAC,OAAO,SAAS,CAAT,CAAR,EAAtB;AACA;AACD,CALD","file":"index.js","sourcesContent":["// main.js\r\n\r\nwindow.onload = ()=>{\r\n\t\r\n\tdocument.body.addEventListener('mousedown', _callback);\r\n\r\n\t// $(\"#draw\").click(_draw);\r\n\t_draw();\r\n\r\n\t_controls();\r\n\t\r\n\t$(\"#btn-add\").click(_add);\r\n\t$(\"#btn-new\").click(setDefaults);\r\n\t$(\"#btn-log\").click(logJson);\r\n\r\n\t$('textarea').on('focus', function() {\r\n\t\tthis.select();\r\n\t});\r\n}\n// common.js\r\n\r\nclass eventClass {\r\n\tconstructor() {\r\n\t\tthis._events = {};\r\n\t}\r\n\ton(_name, _callback) {\r\n\t\tif(this._events[_name]) {\r\n\t\t\tthis._events[_name].push(_callback);\r\n\t\t} else {\r\n\t\t\tthis._events[_name] = [_callback];\r\n\t\t}\r\n\t}\r\n\tdo(_name, _data) {\r\n\t\tif(this._events[_name]) {\r\n\t\t\tfor(let i in this._events[_name]) {\r\n\t\t\t\tif(typeof this._events[_name][i] == \"function\") {\r\n\t\t\t\t\tthis._events[_name][i](_data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nlet event = new eventClass();\r\n\r\nlet layerModel = {\r\n  \"id\"      : \"string\",\r\n  \"x\"       : \"int\"   ,\r\n  \"y\"       : \"int\"   ,\r\n  \"width\"   : \"int\"   ,\r\n  \"height\"  : \"int\"   ,\r\n  \"corners\" : \"array\"\r\n};\r\n\r\nlet layerDefaults = {\r\n  \"id\"     : \"name-game\",\r\n  \"x\"      : 0          ,\r\n  \"y\"      : 0          ,\r\n  \"width\"  : 320        ,\r\n  \"height\" : 480\r\n};\r\n\r\nlet data = null;\r\nlet images = {};\r\n\r\nlet _callback = (e)=>{\r\n\t\r\n\tif(e.target.className.indexOf('ui-resizable') >= 0) {\r\n\r\n\t\tlet _changes = {\r\n\t\t\tid     : e.target.id                   ,\r\n\t\t\twidth  : e.target.width                ,\r\n\t\t\theight : e.target.height               ,\r\n\t\t\tx      : e.target.parentNode.offsetLeft,\r\n\t\t\ty      : e.target.parentNode.offsetTop\r\n\t\t};\r\n\r\n\t\t// _update(_changes.id, _changes);\r\n\r\n\t\tfillChanges(_changes);\r\n\t}\r\n};\r\n\r\nlet _add = ()=>{\r\n\r\n\tlet _id = $('#input-id').val();\r\n\tif(_id == '') {\r\n\t\talert('ID is empty');\r\n\t} else if(mesh.layers[_id]) {\r\n\t\talert('\"' + _id + '\" isset');\r\n\t} else {\r\n\t\tlet _layer = {};\r\n\t\tfor(let i in layerModel) {\r\n\t\t\tif(i != 'id' && layerModel[i] == 'int') {\r\n\t\t\t\t_layer[i] = $('#input-' + i).val();\r\n\t\t\t} else if(layerModel[i] == 'array') {\r\n\t\t\t\t_layer[i] = [];\r\n\t\t\t}\r\n\t\t}\r\n\t\tmesh.layers[_id] = _layer;\r\n\t\taddLayer(_id, mesh.layers[_id]);\r\n\t}\r\n\t// mesh.layers.['test-name'] = _tmp;\r\n};\r\n\r\nlet _clear = ()=>{\r\n\tfor(let i in layerModel) {\r\n\t\t$('#input-' + i).prop({value: null});\r\n\t}\r\n};\r\n\r\nlet setDefaults = ()=>{\r\n\tfor(let i in layerDefaults) {\r\n\t\t$('#input-' + i).prop({value: layerDefaults[i]});\r\n\t}\r\n};\r\n\r\nlet changedForm = () => {\r\n\r\n\t_updateFromForm();\r\n\t// redraw element\r\n}\r\n\r\nlet _update = (_id, _layer)=>{\r\n\tif(!mesh.layers[_id]) { return; }\r\n\tfor(let i in _layer) {\r\n\t\tif(i != 'id') {\r\n\t\t\tmesh.layers[_id][i] = _layer[i];\r\n\t\t}\r\n\t}\r\n};\r\n\r\nlet updateFromForm = ()=>{\r\n\tlet _form = _getForm();\r\n\r\n\tconsole.log('updateFromForm:', _form);\r\n\r\n\t_update(_form.id, _form);\r\n}\r\n\r\nlet _getForm = ()=>{\r\n\tlet _form = {};\r\n\tfor(let i in layerModel) {\r\n\t\t_form[i] = $('#input-' + i).val()\r\n\t}\r\n\treturn _form;\r\n};\n// getData.js\r\n\r\nlet getJson = ()=>{\r\n\treturn JSON.stringify(mesh, true, 2);\r\n};\r\n\r\nlet logJson = ()=>{\r\n\r\n\tlet _json = getJson();\r\n\t// console.clear();\r\n\t// console.log(getJson());\r\n\t$('textarea')\r\n\t\t.val(_json)\r\n\t\t.show()\r\n\t\t.select()\r\n\t\t.css({zIndex: 999});\r\n\t$('#controls')\r\n\t\t.hide();\r\n}\r\n\r\nconst ESC_KEY = 0x1b;\r\n\r\nwindow.onkeyup = (e) => {\r\n\tif(e.keyCode == ESC_KEY) {\r\n\t\t$('#controls')\r\n\t\t\t.show();\r\n\t\t$('textarea')\r\n\t\t\t.hide();\r\n\t}\r\n};\n// ui.js\r\n\r\nlet addLayer = (_name, _layer)=>{\r\n\r\n\t$(\"#container\").append(\r\n\t\t\t$(\"<img>\")\r\n\t\t\t\t.prop({\r\n\t\t\t\t\tsrc: '../res/' + _name + '.jpg',\r\n\t\t\t\t\tid: _name\r\n\t\t\t\t})\r\n\t\t);\r\n\t\t$('#' + _name)\r\n\t\t\t.css({\r\n\t\t\t\twidth  : _layer.width  + 'px',\r\n\t\t\t\theight : _layer.height + 'px',\r\n\t\t\t\ttop    : _layer.y      + 'px',\r\n\t\t\t\tleft   : _layer.x      + 'px'\r\n\t\t\t})\r\n\t\t\t.resizable({\r\n\t      aspectRatio: _layer.width / _layer.height,\r\n\t      stop: (e) => {\r\n\t      \tconsole.log('resize:', e);\r\n\t      }\r\n\t    })\r\n\t    // .done(() => {alert(2);})\r\n\t\t\t.parent()\r\n\t\t\t\t.draggable({\r\n\t\t\t\t\tstack: \".drag\",\r\n\t\t\t\t\tgrid:[10, 10],\r\n\t\t\t\t\tstop: (e) => {\r\n\t\t\t\t\t\tconsole.log('drag:', e);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t// .done(() => {alert(1);})\r\n\t\t\t\t.addClass(\"drag\")\r\n\t\t\t\t.css({position: 'absolute'});\r\n};\r\n\r\nlet _draw = ()=>{\r\n\r\n\t// let text = $(\"textarea\").val();\r\n\t// data = JSON.parse(text);\r\n\timages = {};\r\n\r\n\tfor(let layerName in mesh.layers) {\r\n\r\n\t\taddLayer(layerName, mesh.layers[layerName]);\r\n\t}\r\n};\r\n\r\nlet addControl = (attr)=>{\r\n\r\n\t$('#controls').append(\r\n\t\t$('<div>').append(\r\n\t\t\t$('<label>')\r\n\t\t\t\t.append(\r\n\t\t\t\t\t$('<span>')\r\n\t\t\t\t\t\t.html(attr + ':')\r\n\t\t\t\t)\r\n\t\t\t\t.append(\r\n\t\t\t\t\t$('<input>')\r\n\t\t\t\t\t\t.prop({\r\n\t\t\t\t\t\t\tid: 'input-' + attr,\r\n\t\t\t\t\t\t\tvalue: null\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.addClass('controls-input')\r\n\t\t\t\t)\r\n\t\t)\r\n\t);\r\n};\r\n\r\nlet _controls = ()=>{\r\n\r\n\tlet o = {};\r\n\tfor(let attr in layerModel) {\r\n\t\r\n\t\tif(layerModel[attr] == \"int\") {\r\n\t\t\to[attr] = 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(layerModel[attr] == \"string\") {\r\n\t\t\to[attr] = \"\";\r\n\t\t}\r\n\t\t\r\n\t\tif(layerModel[attr] == \"array\") {\r\n\t\t\t\to[attr] = [];\r\n\t\t}\r\n\r\n\t\tif(\r\n\t\t\tlayerModel[attr] == \"int\"    ||\r\n\t\t\tlayerModel[attr] == \"string\"\r\n\t\t) {\r\n\t\t\taddControl(attr);\r\n\t\t}\r\n\t}\r\n\r\n\t$('.controls-input').on('change', changedForm);\r\n\r\n\t$('#controls').append(\r\n\t\t$('<button>')\r\n\t\t\t.prop({id: 'btn-new'})\r\n\t\t\t.text('New')\r\n\t);\r\n\r\n\t$('#controls').append(\r\n\t\t$('<button>')\r\n\t\t\t.prop({id: 'btn-add'})\r\n\t\t\t.text('Add')\r\n\t);\r\n\r\n\t// $('#controls').append(\r\n\t// \t$('<button>')\r\n\t// \t\t.prop({id: 'btn-upd'})\r\n\t// \t\t.text('Update')\r\n\t// );\r\n\r\n\t$('#controls').append(\r\n\t\t$('<button>')\r\n\t\t\t.prop({id: 'btn-log'})\r\n\t\t\t.text('Log JSON')\r\n\t);\r\n};\r\n\r\nlet fillChanges = (_changes)=>{\r\n\r\n\tfor(let i in _changes) {\r\n\t\t$('#input-' + i).prop({value: _changes[i]});\r\n\t}\r\n};"]}